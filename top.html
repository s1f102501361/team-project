<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>日本の都道府県おすすめ紹介</title>
  <link rel="stylesheet" href="CSS/top.css">
</head>
<body>

  <h1>日本の都道府県観光地紹介</h1>

  <div id="photoGallery" style="margin-top: 40px;">
    <h2>みんなの写真ギャラリー</h2>

    <div id="slider" style="overflow: hidden; white-space: nowrap; border: 1px solid #ccc; border-radius: 8px;">
      <div id="sliderTrack" style="display: inline-block; transition: transform 0.5s ease;"></div>
    </div>

    <div id="uploadSection" style="margin-top: 20px;">
      <h3>あなたの思い出を投稿しよう</h3>
      <input type="file" id="photoUpload" accept="image/*">
      <button onclick="handleUpload()">アップロード</button>
      <p id="uploadStatus"></p>
    </div>
  </div>


  <input type="text" id="searchBar" placeholder="都道府県を検索">

  <div class="prefecture-list" id="prefectureList">
    <button class="prefecture" data-pref="北海道" onclick="visitPrefecture('北海道')">北海道</button>
    <button class="prefecture" data-pref="青森県" onclick="visitPrefecture('青森県')">青森県</button>
    <button class="prefecture" data-pref="岩手県" onclick="visitPrefecture('岩手県')">岩手県</button>
    <button class="prefecture" data-pref="宮城県" onclick="visitPrefecture('宮城県')">宮城県</button>
    <button class="prefecture" data-pref="秋田県" onclick="visitPrefecture('秋田県')">秋田県</button>
    <button class="prefecture" data-pref="山形県" onclick="visitPrefecture('山形県')">山形県</button>
    <button class="prefecture" data-pref="福島県" onclick="visitPrefecture('福島県')">福島県</button>
    <button class="prefecture" data-pref="茨城県" onclick="visitPrefecture('茨城県')">茨城県</button>
    <button class="prefecture" data-pref="栃木県" onclick="visitPrefecture('栃木県')">栃木県</button>
    <button class="prefecture" data-pref="群馬県" onclick="visitPrefecture('群馬県')">群馬県</button>
    <button class="prefecture" data-pref="埼玉県" onclick="visitPrefecture('埼玉県')">埼玉県</button>
    <button class="prefecture" data-pref="千葉県" onclick="visitPrefecture('千葉県')">千葉県</button>
    <button class="prefecture" data-pref="東京都" onclick="visitPrefecture('東京都')">東京都</button>
    <button class="prefecture" data-pref="神奈川" onclick="visitPrefecture('神奈川県')">神奈川県</button>
    <button class="prefecture" data-pref="新潟県" onclick="visitPrefecture('新潟県')">新潟県</button>
    <button class="prefecture" data-pref="富山県" onclick="visitPrefecture('富山県')">富山県</button>
    <button class="prefecture" data-pref="石川県" onclick="visitPrefecture('石川県')">石川県</button>
    <button class="prefecture" data-pref="福井県" onclick="visitPrefecture('福井県')">福井県</button>
    <button class="prefecture" data-pref="山梨県" onclick="visitPrefecture('山梨県')">山梨県</button>
    <button class="prefecture" data-pref="長野県" onclick="visitPrefecture('長野県')">長野県</button>
    <button class="prefecture" data-pref="岐阜県" onclick="visitPrefecture('岐阜県')">岐阜県</button>
    <button class="prefecture" data-pref="静岡県" onclick="visitPrefecture('静岡県')">静岡県</button>
    <button class="prefecture" data-pref="愛知県" onclick="visitPrefecture('愛知県')">愛知県</button>
    <button class="prefecture" data-pref="三重県" onclick="visitPrefecture('三重県')">三重県</button>
    <button class="prefecture" data-pref="滋賀県" onclick="visitPrefecture('滋賀県')">滋賀県</button>
    <button class="prefecture" data-pref="京都府" onclick="visitPrefecture('京都府')">京都府</button>
    <button class="prefecture" data-pref="大阪府" onclick="visitPrefecture('大阪府')">大阪府</button>
    <button class="prefecture" data-pref="兵庫県" onclick="visitPrefecture('兵庫県')">兵庫県</button>
    <button class="prefecture" data-pref="奈良県" onclick="visitPrefecture('奈良県')">奈良県</button>
    <button class="prefecture" data-pref="和歌山県" onclick="visitPrefecture('和歌山県')">和歌山県</button>
    <button class="prefecture" data-pref="鳥取県" onclick="visitPrefecture('鳥取県')">鳥取県</button>
    <button class="prefecture" data-pref="島根県" onclick="visitPrefecture('島根県')">島根県</button>
    <button class="prefecture" data-pref="岡山県" onclick="visitPrefecture('岡山県')">岡山県</button>
    <button class="prefecture" data-pref="広島県" onclick="visitPrefecture('広島県')">広島県</button>
    <button class="prefecture" data-pref="山口県" onclick="visitPrefecture('山口県')">山口県</button>
    <button class="prefecture" data-pref="徳島県" onclick="visitPrefecture('徳島県')">徳島県</button>
    <button class="prefecture" data-pref="香川県" onclick="visitPrefecture('香川県')">香川県</button>
    <button class="prefecture" data-pref="愛媛県" onclick="visitPrefecture('愛媛県')">愛媛県</button>
    <button class="prefecture" data-pref="高知県" onclick="visitPrefecture('高知県')">高知県</button>
    <button class="prefecture" data-pref="福岡県" onclick="visitPrefecture('福岡県')">福岡県</button>
    <button class="prefecture" data-pref="佐賀県" onclick="visitPrefecture('佐賀県')">佐賀県</button>
    <button class="prefecture" data-pref="長崎県" onclick="visitPrefecture('長崎県')">長崎県</button>
    <button class="prefecture" data-pref="熊本県" onclick="visitPrefecture('熊本県')">熊本県</button>
    <button class="prefecture" data-pref="大分県" onclick="visitPrefecture('大分県')">大分県</button>
    <button class="prefecture" data-pref="宮崎県" onclick="visitPrefecture('宮崎県')">宮崎県</button>
    <button class="prefecture" data-pref="鹿児島県" onclick="visitPrefecture('鹿児島県')">鹿児島県</button>
    <button class="prefecture" data-pref="沖縄県" onclick="visitPrefecture('沖縄県')">沖縄県</button>
  </div>

  <div class="ranking">
    <h2>今月の人気都道府県ランキング</h2>
    <table id="rankingTable">
      <thead>
        <tr><th>順位</th><th>都道府県</th><th>訪問数</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>

    let imagePaths = [
      "uploads/photo1.jpg",
      "uploads/photo2.jpg",
      "uploads/photo3.jpg"
    ];

    const sliderTrack = document.getElementById("sliderTrack");

    function populateSlider() {
      sliderTrack.innerHTML = '';
      const shuffled = [...imagePaths].sort(() => Math.random() - 0.5);
      shuffled.forEach(path => {
        const img = document.createElement("img");
        img.src = path;
        img.style.width = "200px";
        img.style.height = "150px";
        img.style.objectFit = "cover";
        img.style.marginRight = "10px";
        img.style.borderRadius = "4px";
        sliderTrack.appendChild(img);
      });
    }

    function handleUpload() {
      const input = document.getElementById('photoUpload');
      const file = input.files[0];
      const status = document.getElementById('uploadStatus');

      if (!file) {
        status.textContent = 'ファイルを選択してください。';
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        imagePaths.push(e.target.result);
        populateSlider();
        status.textContent = 'アップロード完了！（この端末のみ）';
      };
      reader.readAsDataURL(file);
    }

    function startScrolling() {
      let offset = 0;
      setInterval(() => {
        offset += 1;
        sliderTrack.style.transform = `translateX(-${offset}px)`;
        if (offset > sliderTrack.scrollWidth - 500) {
          offset = 0;
        }
      }, 30);
    }

    populateSlider();
    startScrolling();


    function visitPrefecture(pref) {
      const key = `${new Date().getFullYear()}-${new Date().getMonth() + 1}-${pref}`;
      const visitCounts = JSON.parse(localStorage.getItem('visitCounts') || '{}');
      visitCounts[key] = (visitCounts[key] || 0) + 1;
      localStorage.setItem('visitCounts', JSON.stringify(visitCounts));
      window.location.href = `./都道府県HTML/${pref}.html`;
    }

    function updateRanking() {
      const visitCounts = JSON.parse(localStorage.getItem('visitCounts') || '{}');
      const now = new Date();
      const prefix = `${now.getFullYear()}-${now.getMonth() + 1}-`;

      const monthlyCounts = {};
      for (const key in visitCounts) {
        if (key.startsWith(prefix)) {
          const pref = key.replace(prefix, '');
          monthlyCounts[pref] = (monthlyCounts[pref] || 0) + visitCounts[key];
        }
      }

      const sorted = Object.entries(monthlyCounts).sort((a, b) => b[1] - a[1]);
      const tbody = document.querySelector("#rankingTable tbody");
      tbody.innerHTML = '';
      sorted.forEach(([pref, count], index) => {
        const row = `<tr><td>${index + 1}</td><td>${pref}</td><td>${count}</td></tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });
    }

    document.getElementById("searchBar").addEventListener("input", () => {
      const search = document.getElementById("searchBar").value.trim();
      document.querySelectorAll(".prefecture-list .prefecture").forEach(button => {
        const pref = button.dataset.pref;
        button.style.display = pref.includes(search) ? "inline-block" : "none";
      });
    });

    updateRanking();
  </script>
</body>
</html>
